"use strict";(self.webpackChunkfirehose=self.webpackChunkfirehose||[]).push([[641],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=u(n),d=a,h=m["".concat(s,".").concat(d)]||m[d]||p[d]||i;return n?r.createElement(h,o(o({ref:t},c),{},{components:n})):r.createElement(h,o({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5506:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return p}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],l={},s="Development Guide",u={unversionedId:"contribute/development",id:"contribute/development",title:"Development Guide",description:"The following guide will help you quickly run Firehose in your local machine. The main components of Firehose are:",source:"@site/docs/contribute/development.md",sourceDirName:"contribute",slug:"/contribute/development",permalink:"/firehose/contribute/development",draft:!1,editUrl:"https://github.com/goto/firehose/edit/master/docs/docs/contribute/development.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Contribution Process",permalink:"/firehose/contribute/contribution"},next:{title:"Roadmap",permalink:"/firehose/roadmap"}},c={},p=[{value:"Requirements",id:"requirements",level:2},{value:"Development environment",id:"development-environment",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Kafka Server",id:"kafka-server",level:3},{value:"Destination Sink Server",id:"destination-sink-server",level:3},{value:"Schema Registry",id:"schema-registry",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Running locally",id:"running-locally",level:2},{value:"Configure env/local.properties",id:"configure-envlocalproperties",level:3},{value:"Stencil Workaround",id:"stencil-workaround",level:3},{value:"Run Firehose Log Sink",id:"run-firehose-log-sink",level:3},{value:"Running tests",id:"running-tests",level:3},{value:"Style Guide",id:"style-guide",level:2},{value:"Java",id:"java",level:3},{value:"Making a pull request",id:"making-a-pull-request",level:2},{value:"Incorporating upstream changes from master",id:"incorporating-upstream-changes-from-master",level:4},{value:"Good practices to keep in mind",id:"good-practices-to-keep-in-mind",level:4}],m={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"development-guide"},"Development Guide"),(0,i.kt)("p",null,"The following guide will help you quickly run Firehose in your local machine. The main components of Firehose are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Consumer: Handles data consumption from Kafka."),(0,i.kt)("li",{parentName:"ul"},"Sink: Package which handles sinking data."),(0,i.kt)("li",{parentName:"ul"},"Metrics: Handles the metrics via StatsD client")),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("h3",{id:"development-environment"},"Development environment"),(0,i.kt)("p",null,"Java SE Development Kit 8 is required to build, test and run Firehose service. Oracle JDK 8 can be downloaded from ",(0,i.kt)("a",{parentName:"p",href:"https://www.oracle.com/in/java/technologies/javase/javase-jdk8-downloads.html"},"here"),". Extract the tarball to your preferred installation directory and configure your ",(0,i.kt)("inlineCode",{parentName:"p"},"PATH")," environment variable to point to the ",(0,i.kt)("inlineCode",{parentName:"p"},"bin")," sub-directory in the JDK 8 installation directory. For example -"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export PATH=~/Downloads/jdk1.8.0_291/bin:$PATH\n")),(0,i.kt)("h3",{id:"environment-variables"},"Environment Variables"),(0,i.kt)("p",null,"Firehose environment variables can be configured in either of the following ways -"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"append a new line at the end of ",(0,i.kt)("inlineCode",{parentName:"li"},"env/local.properties")," file. Variables declared in ",(0,i.kt)("inlineCode",{parentName:"li"},"local.properties")," file are automatically added to the environment during runtime."),(0,i.kt)("li",{parentName:"ul"},"run ",(0,i.kt)("inlineCode",{parentName:"li"},"export SAMPLE_VARIABLE=287")," on a UNIX shell, to directly assign the required environment variable.")),(0,i.kt)("h3",{id:"kafka-server"},"Kafka Server"),(0,i.kt)("p",null,"Apache Kafka server service must be set up, from which Firehose's Kafka consumer will pull messages. Kafka Server version greater than 2.4 is currently supported by Firehose. Kafka Server URL and port address, as well as other Kafka-specific parameters must be configured in the corresponding environment variables as defined in the ",(0,i.kt)("a",{parentName:"p",href:"../advance/generic"},"Generic configuration")," section."),(0,i.kt)("p",null,"Read the",(0,i.kt)("a",{parentName:"p",href:"https://kafka.apache.org/quickstart"}," official guide")," on how to install and configure Apache Kafka Server."),(0,i.kt)("h3",{id:"destination-sink-server"},"Destination Sink Server"),(0,i.kt)("p",null,"The sink to which Firehose will stream Kafka's data to, must have its corresponding server set up and configured. The URL and port address of the database server / HTTP/GRPC endpoint , along with other sink - specific parameters must be configured the environment variables corresponding to that particular sink."),(0,i.kt)("p",null,"Configuration parameter variables of each sink can be found in the ",(0,i.kt)("a",{parentName:"p",href:"../advance/generic/"},"Configurations")," section."),(0,i.kt)("h3",{id:"schema-registry"},"Schema Registry"),(0,i.kt)("p",null,"When ",(0,i.kt)("inlineCode",{parentName:"p"},"INPUT_SCHEMA_DATA_TYPE is set to protobuf"),", firehose uses Stencil Server as its Schema Registry for hosting Protobuf descriptors. The environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"SCHEMA_REGISTRY_STENCIL_ENABLE")," must be set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," . Stencil server URL must be specified in the variable ",(0,i.kt)("inlineCode",{parentName:"p"},"SCHEMA_REGISTRY_STENCIL_URLS")," . The Proto Descriptor Set file of the Kafka messages must be uploaded to the Stencil server."),(0,i.kt)("p",null,"Refer ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/goto/stencil/tree/master/server#readme"},"this guide")," on how to set up and configure the Stencil server, and how to generate and upload Proto descriptor set file to the server."),(0,i.kt)("h3",{id:"monitoring"},"Monitoring"),(0,i.kt)("p",null,"Firehose sends critical metrics via StatsD client. Refer the",(0,i.kt)("a",{parentName:"p",href:"/firehose/concepts/monitoring#setting-up-grafana-with-firehose"}," Monitoring")," section for details on how to setup Firehose with Grafana. Alternatively, you can set up any other visualization platform for monitoring Firehose. Following are the typical requirements -"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"StatsD host ","(","e.g. Telegraf",")"," for aggregation of metrics from Firehose StatsD client"),(0,i.kt)("li",{parentName:"ul"},"A time-series database ","(","e.g. InfluxDB",")"," to store the metrics"),(0,i.kt)("li",{parentName:"ul"},"GUI visualization dashboard ","(","e.g. Grafana",")"," for detailed visualisation of metrics")),(0,i.kt)("h2",{id:"running-locally"},"Running locally"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The following guides provide a simple way to run firehose with a log sink locally."),(0,i.kt)("li",{parentName:"ul"},"It uses the TestMessage (src/test/proto/TestMessage.proto) proto schema, which has already been provided for testing purposes.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Clone the repo\n$ git clone https://github.com/goto/firehose.git\n\n# Build the jar\n$ ./gradlew clean build\n\n# Configure env variables\n$ cat env/local.properties\n")),(0,i.kt)("h3",{id:"configure-envlocalproperties"},"Configure env/local.properties"),(0,i.kt)("p",null,"Set the generic variables in the local.properties file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"KAFKA_RECORD_PARSER_MODE = message\nSINK_TYPE = log\nINPUT_SCHEMA_DATA_TYPE=protobuf\nINPUT_SCHEMA_PROTO_CLASS = com.gotocompany.firehose.consumer.TestMessage\n")),(0,i.kt)("p",null,"Set the variables which specify the kafka server, topic name, and group-id of the kafka consumer - the standard values are used here."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"SOURCE_KAFKA_BROKERS = localhost:9092\nSOURCE_KAFKA_TOPIC = test-topic\nSOURCE_KAFKA_CONSUMER_GROUP_ID = sample-group-id\n")),(0,i.kt)("h3",{id:"stencil-workaround"},"Stencil Workaround"),(0,i.kt)("p",null,"Firehose uses ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/goto/stencil"},"Stencil")," as the schema-registry which enables dynamic proto schemas. For the sake of this\nquick-setup guide, we can work our way around Stencil setup by setting up a simple local HTTP server which can provide the static descriptor for TestMessage schema."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Install a server service - like ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/http-party/http-server"},"this")," one.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Generate the descriptor for TestMessage by running the command on terminal -"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"./gradlew generateTestProto\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The above should generate a file (src/test/resources/__files/descriptors.bin), move this to a new folder at a separate location, and start the HTTP-server there so that this file can be fetched at the runtime."),(0,i.kt)("li",{parentName:"ul"},"If you are using ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/http-party/http-server"},"this"),", use this command after moving the file to start server at the default port number 8080.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"http-server\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Because we are not using the schema-registry in the default mode, the following lines should also be added in env/local.properties to specify the new location to fetch descriptor from.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"SCHEMA_REGISTRY_STENCIL_ENABLE = true\nSCHEMA_REGISTRY_STENCIL_URLS = http://localhost:8080/descriptors.bin\nSCHEMA_REGISTRY_STENCIL_CACHE_AUTO_REFRESH = false\nSCHEMA_REGISTRY_STENCIL_REFRESH_STRATEGY = LONG_POLLING\n")),(0,i.kt)("h3",{id:"run-firehose-log-sink"},"Run Firehose Log Sink"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Make sure that your kafka server and local HTTP server containing the descriptor is up and running."),(0,i.kt)("li",{parentName:"ul"},"Run the firehose consumer through the gradlew task:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"./gradlew runConsumer\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note:")," Sample configuration for other sinks along with some advanced configurations can be found ",(0,i.kt)("a",{parentName:"p",href:"../advance/generic/"},"here")),(0,i.kt)("h3",{id:"running-tests"},"Running tests"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Running unit tests\n$ ./gradlew test\n\n# Run code quality checks\n$ ./gradlew checkstyleMain checkstyleTest\n\n#Cleaning the build\n$ ./gradlew clean\n")),(0,i.kt)("h2",{id:"style-guide"},"Style Guide"),(0,i.kt)("h3",{id:"java"},"Java"),(0,i.kt)("p",null,"We conform to the ",(0,i.kt)("a",{parentName:"p",href:"https://google.github.io/styleguide/javaguide.html"},"Google Java Style Guide"),". Maven can helpfully take care of that for you before you commit:"),(0,i.kt)("h2",{id:"making-a-pull-request"},"Making a pull request"),(0,i.kt)("h4",{id:"incorporating-upstream-changes-from-master"},"Incorporating upstream changes from master"),(0,i.kt)("p",null,"Our preference is the use of git rebase instead of git merge. Signing commits"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'# Include -s flag to signoff\n$ git commit -s -m "feat: my first commit"\n')),(0,i.kt)("h4",{id:"good-practices-to-keep-in-mind"},"Good practices to keep in mind"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Follow the ",(0,i.kt)("a",{parentName:"li",href:"https://www.conventionalcommits.org/en/v1.0.0/"},"conventional commit")," format for all commit messages."),(0,i.kt)("li",{parentName:"ul"},"Fill in the description based on the default template configured when you first open the PR"),(0,i.kt)("li",{parentName:"ul"},"Include kind label when opening the PR"),(0,i.kt)("li",{parentName:"ul"},"Add WIP: to PR name if more work needs to be done prior to review"),(0,i.kt)("li",{parentName:"ul"},"Avoid force-pushing as it makes reviewing difficult")))}d.isMDXComponent=!0}}]);